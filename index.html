<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProResume Analyzer | System Live</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Elite resume analysis command center. Full-screen diagnostic tool.">
    <meta name="theme-color" content="#030008">

    <!-- Fonts: Outfit (UI) & JetBrains Mono (Data/Code) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: {
                        void: '#05050a',
                        'void-light': '#12121a',
                        glass: 'rgba(255, 255, 255, 0.05)',
                        border: 'rgba(255, 255, 255, 0.1)',
                        // Distinct Colors for Metrics
                        metric_ats: '#22d3ee', // Cyan
                        metric_imp: '#a855f7', // Purple
                        metric_vrb: '#f43f5e', // Rose
                        metric_skl: '#10b981', // Emerald
                        metric_fmt: '#f59e0b', // Amber
                        metric_dep: '#3b82f6', // Blue
                    },
                    animation: { 
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scan-vertical': 'scanVertical 2s linear infinite',
                        'pop-finish': 'popFinish 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards'
                    },
                    keyframes: {
                        scanVertical: {
                            '0%': { top: '0%', opacity: 0 },
                            '10%': { opacity: 1 },
                            '90%': { opacity: 1 },
                            '100%': { top: '100%', opacity: 0 }
                        },
                        popFinish: {
                            '0%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.2)' },
                            '100%': { transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #05050a; color: #e2e8f0; overflow: hidden; }
        
        /* Clean Glass Panel */
        .glass-panel {
            background: rgba(18, 18, 26, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-card-hover {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease-out;
        }
        
        .glass-card-hover:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Subtle Grid */
        .grid-bg {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        }

        /* Mobile Adjustments */
        @media (max-width: 1024px) {
            body { overflow-y: auto; overflow-x: hidden; }
            .mobile-stack { flex-direction: column; height: auto !important; }
            .mobile-h-auto { height: auto !important; min-height: 300px; }
            .mobile-mt { margin-top: 1rem; }
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* Standard Loader */
        .cyber-loader {
            width: 40px; height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%; border-top-color: #22d3ee;
            animation: rotation 0.8s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #pdfPreviewCanvas {
            width: 100%; height: 100%; object-fit: contain;
            opacity: 0.9;
        }
    </style>
</head>
<body class="h-screen flex flex-col selection:bg-metric_ats selection:text-black">

    <!-- Background -->
    <div class="fixed inset-0 z-0 pointer-events-none">
        <div class="absolute inset-0 grid-bg"></div>
    </div>

    <!-- Top Bar -->
    <nav class="w-full z-50 h-14 border-b border-white/5 bg-void/90 backdrop-blur-md flex-none">
        <div class="w-full h-full px-6 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded bg-gradient-to-br from-metric_ats to-metric_imp flex items-center justify-center">
                    <i class="fa-solid fa-layer-group text-white text-xs"></i>
                </div>
                <div>
                    <h1 class="text-base font-bold tracking-tight text-white leading-none">PRORESUME <span class="text-metric_ats">ANALYZER</span></h1>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <button onclick="showModal('about')" class="text-[10px] font-mono font-bold text-gray-400 hover:text-white transition-colors tracking-wider hidden md:block">ABOUT</button>
                <button onclick="showModal('tips')" class="text-[10px] font-mono font-bold text-gray-400 hover:text-white transition-colors tracking-wider hidden md:block">TIPS</button>
                <div class="hidden md:flex items-center gap-2 px-3 py-1 rounded bg-white/5 border border-white/10">
                    <div class="w-1.5 h-1.5 rounded-full bg-metric_skl animate-pulse"></div>
                    <span class="text-[10px] font-mono text-gray-300 font-bold tracking-wider">SYSTEM LIVE</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 w-full p-4 overflow-hidden relative z-10 flex flex-col items-center">
        
        <!-- Header (Motivational) -->
        <div class="text-center mb-5 flex-none z-20 px-4">
            <h2 class="text-3xl md:text-5xl font-bold text-white leading-tight mb-3">
                Don't Just Apply. <br class="hidden md:block" />
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-metric_ats via-metric_imp to-metric_vrb">Dominate the Market.</span>
            </h2>
            <p class="text-sm text-gray-400 leading-relaxed max-w-2xl mx-auto font-light">
                Unlock your true career potential. Our advanced diagnostic engine reveals the hidden gaps in your resume 
                and provides the strategy you need to <span class="text-white font-medium">stand out instantly.</span>
            </p>
        </div>

        <!-- Main Layout -->
        <div class="w-full h-full max-w-[1500px] mx-auto flex mobile-stack gap-4 flex-1 min-h-0 pb-6">
            
            <!-- Column 1: Upload / Preview (Left - 30%) -->
            <div class="w-full lg:w-[30%] flex flex-col gap-3 h-full mobile-h-auto flex-none">
                <!-- Drop/Preview Zone -->
                <div id="dropZone" class="flex-1 glass-panel rounded-xl relative overflow-hidden group cursor-pointer transition-all hover:border-white/20 flex flex-col">
                    
                    <!-- 1. Idle State -->
                    <div id="uploadIdle" class="absolute inset-0 flex flex-col items-center justify-center p-8 text-center z-10 transition-opacity duration-300">
                        <div class="w-16 h-16 rounded-2xl bg-void-light border border-white/10 flex items-center justify-center mb-5 group-hover:scale-105 transition-all duration-300 group-hover:bg-white/5">
                            <i class="fa-solid fa-cloud-arrow-up text-3xl text-gray-400 group-hover:text-white transition-colors"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">Upload Resume</h3>
                        <p class="text-xs text-gray-500 font-mono mb-5 tracking-wide">PDF or DOCX</p>
                        <button class="px-6 py-2.5 bg-white text-void font-bold text-xs rounded hover:bg-gray-200 transition-colors">SELECT FILE</button>
                    </div>

                    <!-- 2. Preview State -->
                    <div id="previewContainer" class="hidden absolute inset-0 bg-void-light/50 flex-col">
                        <div class="relative w-full h-full overflow-hidden p-4 flex items-center justify-center">
                            <canvas id="pdfPreviewCanvas" class="shadow-xl rounded border border-white/10"></canvas>
                            <div id="docxPreview" class="hidden flex-col items-center">
                                <i class="fa-solid fa-file-word text-6xl text-metric_dep mb-2"></i>
                                <span class="text-white font-bold" id="docxName">filename.docx</span>
                            </div>
                            <!-- Scanner Line -->
                            <div class="absolute inset-0 border-b-2 border-metric_ats/80 z-20 animate-scan-vertical pointer-events-none"></div>
                        </div>
                        <div class="h-10 bg-black/80 backdrop-blur-md flex items-center justify-between px-4 border-t border-white/10 shrink-0">
                            <span class="text-[10px] text-gray-400 font-mono truncate max-w-[150px]" id="previewFilename">file.pdf</span>
                            <button id="reuploadBtn" class="text-[10px] text-metric_vrb hover:text-white uppercase font-bold tracking-wider">CHANGE</button>
                        </div>
                    </div>

                    <!-- 3. Loading State -->
                    <div id="uploadProcessing" class="hidden absolute inset-0 bg-void/95 z-30 flex-col items-center justify-center">
                        <div class="cyber-loader mb-4"></div>
                        <p class="text-gray-400 font-mono text-xs animate-pulse tracking-widest">ANALYZING...</p>
                    </div>

                    <input type="file" id="fileInput" accept=".pdf,.docx" class="hidden">
                </div>

                <!-- Terminal Log -->
                <div class="glass-panel rounded-xl p-3 h-32 flex-none flex flex-col font-mono text-[10px] relative overflow-hidden">
                    <div class="flex justify-between items-center border-b border-white/10 pb-1 mb-1">
                        <span class="text-gray-500 font-bold">SYSTEM_LOG</span>
                        <div class="flex gap-1.5"><div class="w-1.5 h-1.5 rounded-full bg-red-500"></div><div class="w-1.5 h-1.5 rounded-full bg-emerald-500"></div></div>
                    </div>
                    <div id="consoleOutput" class="flex-1 overflow-y-auto space-y-1 text-gray-400 scrollbar-hide">
                        <p>> Core_Logic_Ready...</p>
                    </div>
                </div>
            </div>

            <!-- Column 2: Dashboard (Right - 70%) -->
            <div id="dashboard" class="w-full lg:flex-1 h-full glass-panel rounded-xl p-1 relative flex flex-col transition-all duration-700 mobile-h-auto mobile-mt">
                
                <!-- Content -->
                <div class="flex-1 bg-void-light/30 rounded-lg p-5 flex flex-col overflow-y-auto">
                    <!-- Header -->
                    <div class="flex justify-between items-center mb-5 border-b border-white/5 pb-4">
                        <div class="flex items-center gap-4">
                            <h2 class="text-lg font-bold text-white flex items-center gap-2">
                                <i class="fa-solid fa-chart-pie text-metric_ats"></i> Diagnostic Report
                            </h2>
                        </div>
                        <div class="flex items-center gap-6">
                            <!-- New Scan Button -->
                            <button id="analyzeNewBtnHeader" class="text-[10px] font-bold text-gray-400 hover:text-white flex items-center gap-2 border border-white/10 px-3 py-1.5 rounded bg-white/5 hover:bg-white/10 transition-all group">
                                <i class="fa-solid fa-rotate"></i> NEW SCAN
                            </button>
                            <div class="text-right flex flex-col items-end">
                                <div class="text-[10px] text-gray-500 font-mono uppercase tracking-widest leading-none mb-1">Total Score</div>
                                <div class="relative leading-none">
                                    <div class="text-5xl font-bold text-white tracking-tighter" id="totalScore">00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Metrics Grid (Clean Colors) -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-5">
                        <!-- Cards -->
                        <div class="glass-card-hover p-3 rounded-lg">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs font-bold text-gray-300"><i class="fa-solid fa-robot text-metric_ats mr-2"></i>ATS Check</span><span id="atsScore" class="text-xs font-bold text-metric_ats">0%</span></div>
                            <div class="w-full bg-gray-800 h-1.5 rounded-full mb-1.5"><div id="atsBar" class="bg-metric_ats h-1.5 rounded-full transition-all duration-1000 w-0"></div></div>
                            <p class="text-[10px] text-gray-500 truncate">Keyword parsing accuracy</p>
                        </div>
                        <div class="glass-card-hover p-3 rounded-lg">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs font-bold text-gray-300"><i class="fa-solid fa-chart-line text-metric_imp mr-2"></i>Impact</span><span id="quantScore" class="text-xs font-bold text-metric_imp">0%</span></div>
                            <div class="w-full bg-gray-800 h-1.5 rounded-full mb-1.5"><div id="quantBar" class="bg-metric_imp h-1.5 rounded-full transition-all duration-1000 w-0"></div></div>
                            <p class="text-[10px] text-gray-500 truncate">Metric-driven data points</p>
                        </div>
                        <div class="glass-card-hover p-3 rounded-lg">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs font-bold text-gray-300"><i class="fa-solid fa-bolt text-metric_vrb mr-2"></i>Verbs</span><span id="verbScore" class="text-xs font-bold text-metric_vrb">0%</span></div>
                            <div class="w-full bg-gray-800 h-1.5 rounded-full mb-1.5"><div id="verbBar" class="bg-metric_vrb h-1.5 rounded-full transition-all duration-1000 w-0"></div></div>
                            <p class="text-[10px] text-gray-500 truncate">Strong action vocabulary</p>
                        </div>
                        <div class="glass-card-hover p-3 rounded-lg">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs font-bold text-gray-300"><i class="fa-solid fa-microchip text-metric_skl mr-2"></i>Skills</span><span id="skillScore" class="text-xs font-bold text-metric_skl">0%</span></div>
                            <div class="w-full bg-gray-800 h-1.5 rounded-full mb-1.5"><div id="skillBar" class="bg-metric_skl h-1.5 rounded-full transition-all duration-1000 w-0"></div></div>
                            <p class="text-[10px] text-gray-500 truncate">Hard skill matching</p>
                        </div>
                        <div class="glass-card-hover p-3 rounded-lg">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs font-bold text-gray-300"><i class="fa-solid fa-align-left text-metric_fmt mr-2"></i>Format</span><span id="formatScore" class="text-xs font-bold text-metric_fmt">0%</span></div>
                            <div class="w-full bg-gray-800 h-1.5 rounded-full mb-1.5"><div id="formatBar" class="bg-metric_fmt h-1.5 rounded-full transition-all duration-1000 w-0"></div></div>
                            <p class="text-[10px] text-gray-500 truncate">Layout & structure</p>
                        </div>
                        <div class="glass-card-hover p-3 rounded-lg">
                            <div class="flex justify-between items-center mb-2"><span class="text-xs font-bold text-gray-300"><i class="fa-solid fa-layer-group text-metric_dep mr-2"></i>Depth</span><span id="depthScore" class="text-xs font-bold text-metric_dep">0%</span></div>
                            <div class="w-full bg-gray-800 h-1.5 rounded-full mb-1.5"><div id="depthBar" class="bg-metric_dep h-1.5 rounded-full transition-all duration-1000 w-0"></div></div>
                            <p class="text-[10px] text-gray-500 truncate">Content density</p>
                        </div>
                    </div>

                    <!-- Full Width Critical Analysis (Boxed & Compact) -->
                    <div class="flex-1 min-h-0 flex flex-col gap-4 border-t border-white/5 pt-4 mt-auto">
                        
                        <!-- Strategic Recommendations (Full Width) -->
                        <div class="w-full bg-white/5 rounded-lg p-4 border border-white/5 flex flex-col h-full">
                            <h3 class="text-sm font-bold text-white mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-triangle-exclamation text-metric_fmt"></i> Deep Critical Analysis
                            </h3>
                            <!-- Boxed List: Compact Vertical Stacking -->
                            <div id="recommendationList" class="flex-1 flex flex-col gap-1.5 overflow-y-auto max-h-[160px] scrollbar-hide text-xs font-mono text-gray-400">
                                <div class="p-2 rounded bg-white/5 border border-white/5 flex items-start gap-2.5 opacity-70">
                                    <span class="text-metric_ats mt-0.5 shrink-0"><i class="fa-solid fa-spinner fa-spin"></i></span> 
                                    <span>Upload resume to initialize deep diagnostic scan...</span>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>

        <!-- Footer with Status Ticker -->
        <footer class="absolute bottom-0 w-full h-8 bg-void/90 border-t border-white/5 flex items-center justify-between px-6 text-[10px] text-gray-500 font-mono z-50 backdrop-blur-sm">
            <div class="flex items-center gap-6">
                <span>© 2025 PRORESUME ANALYZER.</span>
                <span id="timeDisplay" class="hidden md:inline text-gray-600"></span>
            </div>
            
            <!-- Live Ticker -->
            <div class="hidden md:flex items-center gap-4">
                <span class="flex items-center gap-2">
                    <span class="w-1 h-1 rounded-full bg-metric_skl"></span>
                    <span id="statusTicker" class="uppercase tracking-wider text-gray-400">ENCRYPTION: SECURE</span>
                </span>
            </div>

            <div class="flex gap-4">
                <button onclick="showModal('privacy')" class="hover:text-white transition-colors">PRIVACY</button>
                <button onclick="showModal('contact')" class="hover:text-metric_ats transition-colors">CONTACT</button>
            </div>
        </footer>

        <!-- Information Modal -->
        <div id="infoModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/80 backdrop-blur-sm">
            <div class="glass-panel w-full max-w-2xl p-8 rounded-xl relative m-4 border border-white/10">
                <button id="closeModalBtn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors"><i class="fa-solid fa-xmark text-lg"></i></button>
                <h3 id="modalTitle" class="text-2xl font-bold text-white mb-6 flex items-center gap-3"></h3>
                <div id="modalContent" class="text-sm text-gray-300 font-mono leading-relaxed space-y-6"></div>
            </div>
        </div>

    </main>

    <!-- JS Logic -->
    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadIdle = document.getElementById('uploadIdle');
        const previewContainer = document.getElementById('previewContainer');
        const pdfPreviewCanvas = document.getElementById('pdfPreviewCanvas');
        const docxPreview = document.getElementById('docxPreview');
        const docxName = document.getElementById('docxName');
        const uploadProcessing = document.getElementById('uploadProcessing');
        const consoleOutput = document.getElementById('consoleOutput');
        const dashboard = document.getElementById('dashboard');
        const totalScoreEl = document.getElementById('totalScore');
        const reuploadBtn = document.getElementById('reuploadBtn');
        const previewFilename = document.getElementById('previewFilename');
        const recommendationList = document.getElementById('recommendationList');
        const analyzeNewBtnHeader = document.getElementById('analyzeNewBtnHeader');
        const timeDisplay = document.getElementById('timeDisplay');
        const statusTicker = document.getElementById('statusTicker');

        // Real-time Clock
        setInterval(() => {
            const now = new Date();
            timeDisplay.innerText = now.toISOString().split('T')[0] + ' ' + now.toLocaleTimeString('en-GB');
        }, 1000);

        // Status Ticker Animation
        const statuses = ["ENCRYPTION: SECURE", "MEMORY: OPTIMIZED", "LATENCY: 12MS", "SERVER: OFFLINE MODE", "READY"];
        let statusIdx = 0;
        setInterval(() => {
            statusIdx = (statusIdx + 1) % statuses.length;
            statusTicker.innerText = statuses[statusIdx];
        }, 3000);

        // Modal Elements
        const infoModal = document.getElementById('infoModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const closeModalBtn = document.getElementById('closeModalBtn');

        const modalData = {
            privacy: {
                title: '<i class="fa-solid fa-shield-halved text-metric_skl"></i> Protocol: Zero-Retention',
                body: `<p><strong class="text-metric_skl">Absolute Privacy Guarantee:</strong> This system operates entirely within your browser's local memory (Client-Side). Unlike standard analyzers, your resume file is <strong>never</strong> uploaded to any server, cloud storage, or third-party database.</p>
                       <p>We utilize advanced WebAssembly libraries to process PDF and DOCX files directly on your device. This ensures that your personal data, contact information, and career history remain physically in your possession at all times.</p>
                       <p class="p-4 bg-white/5 rounded border border-white/10 text-xs"><strong>Security Note:</strong> Once you refresh this page or close this tab, all analysis data is instantly and permanently obliterated from your browser's RAM.</p>`
            },
            contact: {
                title: '<i class="fa-solid fa-envelope text-metric_ats"></i> Engineering Contact',
                body: `<p><strong class="text-metric_ats">Developer Channel:</strong></p>
                       <p>We are dedicated to maintaining the highest standard of algorithmic accuracy. For detailed bug reports, feature requests, or enterprise licensing inquiries, please contact the lead engineering team directly.</p>
                       <p class="mt-4"><a href="#" class="text-metric_ats hover:text-white transition-colors border-b border-metric_ats hover:border-white pb-0.5">engineering@proresume.analyzer</a></p>`
            },
            about: {
                title: '<i class="fa-solid fa-circle-info text-metric_imp"></i> Mission Directive',
                body: `<p><strong class="text-metric_imp">Democratizing Career Intelligence:</strong> The modern hiring landscape is guarded by unfeeling algorithms. We built ProResume Analyzer to level the playing field.</p>
                       <p>Our mission is to arm every candidate with the same high-grade diagnostic tools used by Fortune 500 recruitment systems. By reverse-engineering ATS logic, we provide you with the actionable intelligence needed to bypass the bots and put your story directly in human hands.</p>
                       <p>We believe in <strong class="text-white">Career Sovereignty</strong>: Your data, your strategy, your future. Unlocked.</p>`
            },
            tips: {
                title: '<i class="fa-solid fa-trophy text-metric_fmt"></i> Hall of Fame Rules',
                body: `<div class="space-y-6">
                        <div class="flex gap-4"><span class="text-metric_ats font-bold text-xl">01.</span> <div><strong class="text-metric_ats text-lg block mb-1">Reverse Chronology is King</strong> <p>Always list experience new to old. Recruiters spend 74% of their 6-second scan on your current role. Don't bury the lead.</p></div></div>
                        <div class="flex gap-4"><span class="text-metric_imp font-bold text-xl">02.</span> <div><strong class="text-metric_imp text-lg block mb-1">The Bullet Point Protocol</strong> <p>Banish dense text blocks immediately. Use 3-5 punchy, single-line bullet points per role to hook scanners instantly.</p></div></div>
                        <div class="flex gap-4"><span class="text-metric_vrb font-bold text-xl">03.</span> <div><strong class="text-metric_vrb text-lg block mb-1">Aggressive Quantification</strong> <p>"Managed budget" is weak. "Managed $50k annual budget" is undeniable. Numbers are the universal language of competence.</p></div></div>
                        <div class="flex gap-4"><span class="text-metric_skl font-bold text-xl">04.</span> <div><strong class="text-metric_skl text-lg block mb-1">Keyword Mirroring</strong> <p>If the job description says "Project Management", do not write "Team Leading". Use the exact keywords to score high relevance.</p></div></div>
                        <div class="flex gap-4"><span class="text-metric_fmt font-bold text-xl">05.</span> <div><strong class="text-metric_fmt text-lg block mb-1">PDF Integrity</strong> <p>Always submit as PDF to lock your formatting across all devices. Ensure text is selectable (not an image scan) for bots to read it.</p></div></div>
                       </div>`
            }
        };

        function showModal(type) {
            const data = modalData[type];
            if(data) {
                modalTitle.innerHTML = data.title;
                modalContent.innerHTML = data.body;
                infoModal.classList.remove('hidden');
                infoModal.classList.add('flex');
            }
        }

        closeModalBtn.addEventListener('click', () => {
            infoModal.classList.add('hidden');
            infoModal.classList.remove('flex');
        });

        infoModal.addEventListener('click', (e) => {
            if(e.target === infoModal) {
                infoModal.classList.add('hidden');
                infoModal.classList.remove('flex');
            }
        });

        function log(msg, type='info') {
            const p = document.createElement('p');
            const time = new Date().toLocaleTimeString('en-US',{hour12:false,hour:"2-digit",minute:"2-digit",second:"2-digit"});
            p.innerHTML = `<span class="opacity-50">[${time}]</span> ${msg}`;
            if(type==='error') p.className = 'text-red-400';
            if(type==='success') p.className = 'text-emerald-400';
            if(type==='process') p.className = 'text-metric_ats';
            consoleOutput.appendChild(p);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        dropZone.addEventListener('click', () => { if(uploadIdle.style.display !== 'none') fileInput.click(); });
        reuploadBtn.addEventListener('click', (e) => { e.stopPropagation(); resetUI(); fileInput.click(); });
        analyzeNewBtnHeader.addEventListener('click', resetUI);
        
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('border-white/30'); });
        dropZone.addEventListener('dragleave', (e) => { e.preventDefault(); dropZone.classList.remove('border-white/30'); });
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('border-white/30'); handleFiles(e.dataTransfer.files); });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        async function handleFiles(files) {
            if(!files.length) return;
            const file = files[0];
            
            // UI Transition
            uploadIdle.style.display = 'none';
            previewContainer.classList.add('hidden');
            uploadProcessing.classList.remove('hidden');
            uploadProcessing.classList.add('flex');
            
            log(`Initializing upload: ${file.name}`, 'process');

            try {
                // 1. Render Preview
                if (file.type === 'application/pdf') {
                    await renderPDFPreview(file);
                } else if (file.name.endsWith('.docx')) {
                    renderDOCXPreview(file);
                } else {
                    throw new Error("Invalid file type.");
                }

                // 2. Extract Text
                let text = '';
                if(file.type === 'application/pdf') {
                    const ab = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({data:ab}).promise;
                    for(let i=1; i<=pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const content = await page.getTextContent();
                        text += content.items.map(item=>item.str).join(' ') + ' ';
                    }
                } else {
                    const ab = await file.arrayBuffer();
                    const res = await mammoth.extractRawText({arrayBuffer:ab});
                    text = res.value;
                }

                if(!text || text.length < 50) throw new Error("Document appears empty.");
                
                // 3. Analyze
                await new Promise(r => setTimeout(r, 600)); // Simulate think time
                log('Preview generated. Analyzing content...', 'success');
                
                // Show Preview UI
                uploadProcessing.classList.remove('flex');
                uploadProcessing.classList.add('hidden');
                previewContainer.classList.remove('hidden');
                previewContainer.classList.add('flex');
                previewFilename.innerText = file.name;

                analyze(text);

            } catch(e) {
                log(`Error: ${e.message}`, 'error');
                resetUI();
            }
        }

        async function renderPDFPreview(file) {
            const fileReader = new FileReader();
            return new Promise((resolve, reject) => {
                fileReader.onload = async function() {
                    const typedarray = new Uint8Array(this.result);
                    try {
                        const pdf = await pdfjsLib.getDocument(typedarray).promise;
                        const page = await pdf.getPage(1);
                        const viewport = page.getViewport({scale: 1.5});
                        const context = pdfPreviewCanvas.getContext('2d');
                        pdfPreviewCanvas.height = viewport.height;
                        pdfPreviewCanvas.width = viewport.width;
                        
                        await page.render({canvasContext: context, viewport: viewport}).promise;
                        
                        pdfPreviewCanvas.classList.remove('hidden');
                        docxPreview.classList.add('hidden');
                        resolve();
                    } catch (e) { reject(e); }
                };
                fileReader.readAsArrayBuffer(file);
            });
        }

        function renderDOCXPreview(file) {
            pdfPreviewCanvas.classList.add('hidden');
            docxPreview.classList.remove('hidden');
            docxPreview.classList.add('flex');
            docxName.innerText = file.name;
        }

        function analyze(text) {
            const lower = text.toLowerCase();
            const words = text.split(/\s+/).length;

            // Metrics Logic
            const ats = Math.min(Math.round((['experience','education','skills','summary','project'].filter(k=>lower.includes(k)).length/5)*100), 100);
            const quant = Math.min((text.match(/\d+%|\$\d+/g)||[]).length * 15, 100);
            const verbs = Math.min((text.match(/\b(led|created|managed|developed)\b/gi)||[]).length * 20, 100);
            const skills = Math.min((['javascript','python','java','react','sql','aws','management','sales'].filter(s=>lower.includes(s)).length * 15), 100);
            const format = (lower.includes('@')?25:0) + (lower.includes('linkedin')?25:0) + (text.includes('•')?50:0);
            const depth = words > 400 ? 100 : (words/400)*100;

            const total = Math.round((ats * 0.2) + (quant * 0.2) + (verbs * 0.15) + (skills * 0.15) + (format * 0.15) + (depth * 0.15));

            
            // Animate
            animateValue(totalScoreEl, 0, total, 1500);
            
            // Update Bars
            updateBar('ats', ats); updateBar('quant', quant); updateBar('verb', verbs); 
            updateBar('skill', skills); updateBar('format', format); updateBar('depth', depth);

            // Generate Expanded Recommendations
            generateRecommendations({ats, quant, verbs, format, skills, depth}, text);
        }

        function generateRecommendations(scores, text) {
            let recs = [];
            const lowerText = text.toLowerCase();
            
            // 1. Critical Errors
            if(scores.ats < 70) recs.push("Missed standard section headers (Experience, Education). ATS may fail to parse.");
            if(scores.format < 80) recs.push("Incomplete contact info or bullet points missing. Ensure bullet points are used.");
            
            // 2. Improvements
            if(scores.quant < 60) recs.push("Low quantification. Add numbers (%, $) to prove impact.");
            if(scores.verbs < 60) recs.push("Passive voice detected. Use strong action verbs (Led, Created).");
            
            // 3. Nuance/Depth
            if(scores.depth < 50) recs.push("Resume is too brief. Expand on role details to hit 400+ words.");
            if(scores.depth > 95) recs.push("Resume might be too dense. Ensure white space is sufficient.");
            
            // 4. Advanced/Specific Checks
            if(text.includes('references available upon request')) recs.push("Remove 'References available upon request'. It wastes valuable space.");
            if(!lowerText.includes('linkedin.com/in/')) recs.push("Add a customized LinkedIn URL for professional verification.");
            if(lowerText.includes('objective')) recs.push("Replace 'Objective' with 'Professional Summary'. Objectives are outdated.");
            if((text.match(/I /g) || []).length > 5) recs.push("Reduce use of personal pronouns ('I', 'Me'). Keep it objective.");

            // 5. Fillers if needed to reach meaningful count
            if(recs.length < 4) {
                if(scores.skills < 100) recs.push("Add more technical keywords relevant to your target role.");
                recs.push("Consider adding a 'Key Achievements' section to highlight wins.");
                recs.push("Ensure hyperlinked text (LinkedIn, Portfolio) is active.");
            }

            // Cap at 8 items
            recs = recs.slice(0, 8);

            // Boxed Item Rendering (Compact)
            recommendationList.innerHTML = recs.map(r => `
                <div class="flex items-start gap-2.5 p-1.5 rounded bg-white/5 border border-white/5 hover:border-metric_ats/30 hover:bg-white/10 transition-all duration-200 cursor-default">
                    <span class="text-metric_ats mt-0.5 shrink-0 text-[10px]">
                        <i class="fa-solid fa-angle-right"></i>
                    </span> 
                    <span class="leading-snug text-gray-300 text-[10px]">${r}</span>
                </div>
            `).join('');
        }

        function updateBar(id, val) {
            document.getElementById(id+'Score').innerText = Math.round(val) + '%';
            setTimeout(() => document.getElementById(id+'Bar').style.width = val + '%', 100);
        }

        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const ease = 1 - Math.pow(1 - progress, 4);
                
                const currentValue = Math.floor(ease * (end - start) + start);
                obj.innerHTML = currentValue;
                
                // Color Transition Logic
                if(currentValue < 40) obj.style.color = '#f43f5e'; // Red
                else if(currentValue < 70) obj.style.color = '#f59e0b'; // Amber
                else obj.style.color = '#10b981'; // Emerald

                if (progress < 1) {
                    window.requestAnimationFrame(step);
                } else {
                    // Trigger pop animation on finish
                    obj.classList.add('animate-pop-finish');
                }
            };
            window.requestAnimationFrame(step);
        }

        function resetUI() {
            uploadProcessing.classList.add('hidden');
            uploadProcessing.classList.remove('flex');
            previewContainer.classList.add('hidden');
            previewContainer.classList.remove('flex');
            uploadIdle.style.display = 'flex';
            fileInput.value = '';
            
            ['ats','quant','verb','skill','format','depth'].forEach(id=>{ 
                document.getElementById(id+'Bar').style.width='0%'; 
                document.getElementById(id+'Score').innerText='0%'; 
            });
            totalScoreEl.innerText = '00';
            totalScoreEl.style.color = 'white';
            totalScoreEl.classList.remove('animate-pop-finish');
            
            recommendationList.innerHTML = `
                <div class="flex items-start gap-2.5 p-1.5 rounded bg-white/5 border border-white/5 opacity-50">
                    <span class="text-metric_ats mt-0.5 shrink-0 text-[10px]"><i class="fa-solid fa-spinner fa-spin"></i></span> 
                    <span class="text-gray-400 text-[10px]">Upload resume to initialize deep diagnostic scan...</span>
                </div>
            `;
            log('System reset.', 'process');
        }
    </script>
</body>
</html>
