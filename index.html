<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wealth Strategy Analyzer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            
            --primary: #4F46E5;       /* Indigo 600 */
            --primary-light: #818CF8;
            --primary-dark: #4338CA;
            --secondary: #64748B;     /* Slate 500 */
            --bg-app: #F8FAFC;        /* Slate 50 */
            --bg-panel: #FFFFFF;      /* White */
            --bg-sidebar: #0F172A;    /* Slate 900 */
            --text-main: #1E293B;     /* Slate 800 */
            --text-muted: #94A3B8;    /* Slate 400 */
            --text-on-dark: #F8FAFC;  /* Slate 50 */
            --border: #E2E8F0;        /* Slate 200 */
            --success: #10B981;       /* Emerald 500 */
            --danger: #EF4444;        /* Red 500 */
            --accent-purple: #8B5CF6; /* Violet 500 */
            --accent-orange: #F97316; /* Orange 500 */
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);

            /* Table Background Tints */
            --tint-reg: #F1F5F9;
            --tint-fix: #F3E8FF;
            --tint-per: #DCFCE7;
            --tint-lum: #FFEDD5;
        }

        body.dark-theme {
            --primary: #6366F1;
            --primary-light: #A5B4FC;
            --primary-dark: #4338CA;
            --secondary: #94A3B8;
            --bg-app: #020617;
            --bg-panel: #1E293B;
            --bg-sidebar: #020617;
            --text-main: #F1F5F9;
            --text-muted: #64748B;
            --text-on-dark: #E2E8F0;
            --border: #334155;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);

            /* Dark Tints */
            --tint-reg: #0F172A;
            --tint-fix: #2E1065;
            --tint-per: #064E3B;
            --tint-lum: #431407;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            font-size: 13px;
        }

        /* --- Layout --- */
        .dashboard-container {
            display: grid;
            grid-template-columns: 260px 1fr; /* Fixed sidebar width */
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* --- Sidebar --- */
        .sidebar {
            background-color: var(--bg-sidebar);
            color: var(--text-on-dark);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            height: 100%;
            overflow-y: hidden; 
            z-index: 10;
        }

        .sidebar-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-sidebar);
            flex-shrink: 0;
        }
        
        .sidebar-header h1 { font-size: 0.85rem; font-weight: 700; color: white; letter-spacing: 0.02em; }

        .sidebar-content { 
            padding: 0.75rem 1rem; 
            overflow-y: auto;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.2) transparent;
        }

        .sidebar-footer {
            padding: 0.75rem 1rem;
            background: rgba(0,0,0,0.2);
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }

        /* Compact Inputs */
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .input-group { margin-bottom: 0.5rem; }
        .input-group label {
            display: block; font-size: 0.6rem; text-transform: uppercase;
            letter-spacing: 0.05em; font-weight: 600; color: var(--text-muted);
            margin-bottom: 0.2rem;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .input-group input, .input-group select {
            width: 100%; background-color: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1); color: white;
            padding: 0.35rem 0.5rem; border-radius: 6px;
            font-family: inherit; font-size: 0.75rem; transition: all 0.2s;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none; border-color: var(--primary);
            background-color: rgba(255,255,255,0.1);
        }

        .section-title {
            color: var(--primary-light); font-size: 0.65rem; font-weight: 700;
            margin: 0.5rem 0 0.25rem 0; display: flex; align-items: center; gap: 0.5rem;
        }
        .section-title::after { content: ''; flex: 1; height: 1px; background: rgba(255,255,255,0.1); }

        .scenario-chips { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.25rem; margin-bottom: 0.5rem; }
        .chip {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1); color: var(--text-muted);
            padding: 0.25rem; font-size: 0.6rem; border-radius: 4px;
            cursor: pointer; text-align: center; transition: all 0.2s;
        }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); }

        .reset-btn {
            width: 100%; background: transparent; border: 1px dashed rgba(255,255,255,0.3);
            color: var(--text-muted); padding: 0.4rem; border-radius: 6px;
            cursor: pointer; font-size: 0.7rem; margin-top: 0.5rem; transition: 0.2s;
        }
        .reset-btn:hover { border-color: var(--text-on-dark); color: var(--text-on-dark); }
        
        /* Strategy DNA Visual Widget (Sidebar Footer) */
        .dna-panel {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 0.75rem;
        }
        .dna-title {
            font-size: 0.65rem; font-weight: 700; color: var(--text-muted); 
            text-transform: uppercase; margin-bottom: 0.75rem; letter-spacing: 0.05em;
            display: flex; justify-content: space-between;
        }
        .dna-row {
            margin-bottom: 0.6rem;
        }
        .dna-row:last-child { margin-bottom: 0; }
        
        .dna-label {
            display: flex; justify-content: space-between; font-size: 0.7rem; 
            color: var(--text-on-dark); margin-bottom: 0.25rem; font-weight: 600;
        }
        .dna-bar-bg {
            height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;
        }
        .dna-bar-fill {
            height: 100%; border-radius: 3px; width: 0; transition: width 1s ease-out;
        }
        
        .fill-reg { background-color: var(--secondary); }
        .fill-fix { background-color: var(--accent-purple); }
        .fill-per { background-color: var(--success); }
        .fill-lum { background-color: var(--accent-orange); }

        /* --- Main Panel --- */
        .main-panel {
            display: flex; flex-direction: column;
            height: 100%; overflow: hidden; padding: 0.75rem; gap: 0.75rem;
            background: var(--bg-app);
        }

        /* Summary Cards */
        .summary-grid {
            display: grid; 
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            flex-shrink: 0;
        }

        .card {
            background: var(--bg-panel); border-radius: var(--radius);
            padding: 0.75rem; box-shadow: var(--shadow);
            border: 1px solid var(--border); position: relative;
            display: flex; flex-direction: column;
            min-height: 120px;
        }
        
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; }
        .card.regular::before { background: var(--secondary); }
        .card.fixed::before { background: var(--accent-purple); }
        .card.percent::before { background: var(--success); }
        .card.lumpsum::before { background: var(--accent-orange); }

        .card-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 0.5rem; padding-bottom: 0.4rem;
            border-bottom: 1px solid var(--border);
        }
        .card-header h3 { font-size: 0.8rem; font-weight: 700; color: var(--text-main); white-space: nowrap; }
        
        .badge { 
            font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; 
            font-weight: 600; display: inline-flex; align-items: center; gap: 4px;
        }
        .badge.gold { background: #FEF3C7; color: #B45309; border: 1px solid #FCD34D; }
        .badge.silver { background: #F1F5F9; color: #475569; border: 1px solid #CBD5E1; }
        .badge.bronze { background: #FFEDD5; color: #9A3412; border: 1px solid #FDBA74; }
        .badge.base { background: var(--bg-app); color: var(--text-muted); }

        /* Metrics */
        .card-metrics {
            display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem 0.5rem;
            font-size: 0.75rem; flex: 1;
        }

        .metric-item { display: flex; flex-direction: column; overflow: hidden; justify-content: center; }
        .metric-label { font-size: 0.65rem; color: var(--text-muted); margin-bottom: 0; white-space: nowrap; line-height: 1.2; }
        .metric-value { font-weight: 600; color: var(--text-main); font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.3; }
        
        .main-val { grid-column: span 2; margin-bottom: 0.25rem; }
        .main-val-container { display: flex; align-items: baseline; gap: 6px; flex-wrap: wrap;}
        .highlight { font-weight: 800; font-size: 1.1rem; color: var(--primary); }
        .gain-badge { font-size: 0.75rem; font-weight: 700; color: var(--success); }
        
        .card.percent .highlight { color: var(--success); }
        .card.fixed .highlight { color: var(--accent-purple); }
        .card.regular .highlight { color: var(--secondary); }
        .card.lumpsum .highlight { color: var(--accent-orange); }

        .met-year { color: var(--success); font-weight: 700; }
        .missed-year { color: var(--danger); font-size: 0.7rem; }

        /* --- Table Section (Flexbox Auto-fit) --- */
        .table-wrapper {
            background: var(--bg-panel); border-radius: var(--radius);
            border: 1px solid var(--border); box-shadow: var(--shadow);
            flex: 1; /* Fills remaining vertical space */
            display: flex; flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        .table-header-title {
            padding: 0.5rem 0.75rem; font-weight: 700; font-size: 0.75rem;
            border-bottom: 1px solid var(--border); background: var(--bg-app);
            color: var(--text-main); flex-shrink: 0;
        }

        .auto-size-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-panel);
        }

        .flex-table {
            display: flex; flex-direction: column;
            height: 100%; width: 100%; font-size: 0.75rem;
        }

        .flex-thead {
            flex-shrink: 0; background: var(--bg-app); border-bottom: 1px solid var(--border);
        }

        .flex-row { display: flex; width: 100%; align-items: center; }

        .flex-tbody {
            display: flex; flex-direction: column; flex: 1;
            overflow: hidden; 
        }

        .flex-tbody .flex-row { flex: 1; min-height: 0; }

        .flex-cell {
            flex: 1; padding: 0 0.4rem; text-align: right;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            color: var(--text-main); display: flex; align-items: center; justify-content: flex-end;
            height: 100%; font-variant-numeric: tabular-nums;
            border-bottom: 1px solid rgba(100, 116, 139, 0.1); 
        }
        
        .w-yr { 
            width: 32px; flex: none; justify-content: center; 
            font-weight: 700; border-right: 1px solid var(--border); 
            background: var(--bg-app); color: var(--text-muted); 
        }
        
        /* Modified Flex Groups for 4 Columns */
        .group-reg { flex: 4; background-color: var(--tint-reg); display: flex; height: 100%; }
        .group-fix { flex: 4; background-color: var(--tint-fix); display: flex; border-left: 1px solid var(--border); height: 100%; }
        .group-per { flex: 4; background-color: var(--tint-per); display: flex; border-left: 1px solid var(--border); height: 100%; }
        /* Lumpsum stays 3 columns */
        .group-lum { flex: 3; background-color: var(--tint-lum); display: flex; border-left: 1px solid var(--border); height: 100%; }

        .flex-thead .flex-row { height: 28px; } 
        .flex-thead .flex-cell { font-weight: 600; color: var(--text-muted); font-size: 0.7rem; justify-content: center; border-bottom: none; }
        
        /* Revised Cell Widths for 4-Col Layout */
        .c-val { flex: 1.4; font-weight: 600; }
        .c-tinv { flex: 1.2; color: var(--text-muted); font-size: 0.7rem; } /* New Total Inv */
        .c-inv { flex: 1; color: var(--text-muted); font-size: 0.7rem; } /* Yearly Inv */
        .c-pct { flex: 0.9; color: var(--text-muted); font-size: 0.7rem; }

        .col-reg { color: var(--secondary); }
        .col-fix { color: var(--accent-purple); }
        .col-per { color: var(--success); }
        .col-lum { color: var(--accent-orange); }

        .group-lum .flex-cell:last-child { padding-right: 1rem; }

        /* Theme Toggle */
        .theme-toggle-label { position: relative; display: inline-block; width: 32px; height: 18px; }
        .theme-toggle-label input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255,255,255,0.2); transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 12px; width: 12px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(14px); }

        /* --- RESPONSIVE DESIGN --- */
        
        /* Tablet Portrait (Vertical Layout) */
        @media (max-width: 1024px) {
            .summary-grid { grid-template-columns: 1fr 1fr; }
        }

        /* Mobile (Full Stack) */
        @media (max-width: 768px) {
            body { 
                overflow: auto; /* Enable Scroll for mobile */
                height: auto;
                font-size: 14px; /* Larger font for readability */
            }
            .dashboard-container { 
                display: flex; 
                flex-direction: column; 
                height: auto; 
                overflow: visible;
            }
            .sidebar { 
                height: auto; 
                border-right: none; 
                border-bottom: 1px solid var(--border);
                overflow: visible;
            }
            .sidebar-content { padding: 1rem; }
            .sidebar-footer { border-top: 1px solid var(--border); }
            
            .main-panel { 
                height: auto; 
                padding: 1rem;
                overflow: visible;
            }
            
            .summary-grid { 
                grid-template-columns: 1fr; /* Stack cards */
                gap: 1rem;
            }
            
            .table-wrapper { 
                height: 600px; /* Fixed height for table scrolling */
                margin-bottom: 2rem;
            }
            
            /* Table Adjustments for Mobile */
            .flex-tbody { overflow-y: auto; display: block; } 
            .flex-tbody .flex-row { height: 40px; flex: none; }
            .flex-thead { position: sticky; top: 0; z-index: 10; }
            
            /* Simplify table on mobile if needed */
            .c-tinv, .c-inv, .c-pct { display: none; } /* Show only value on tiny screens */
            .flex-cell { font-size: 0.85rem; }
            .c-val { flex: 1; text-align: center; }
            .group-reg, .group-fix, .group-per, .group-lum { flex: 1; justify-content: center; }
        }

        /* Tiny Phone Adjustment to show minimal data */
        @media (min-width: 480px) and (max-width: 768px) {
             .c-tinv { display: flex; } /* Show Total Inv on larger phones */
        }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>Wealth Strategy Analyzer</h1>
                <label class="theme-toggle-label">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="sidebar-content">
                <form id="sipForm">
                    <div class="section-title" style="margin-top:0">Monthly Investment</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Amount (â‚¹)</label>
                            <input type="number" id="initialSip" value="7000" min="500" max="100000" step="500">
                        </div>
                        <div class="input-group">
                            <label>Lumpsum (â‚¹)</label>
                            <input type="number" id="lumpsumAmount" value="500000" min="0" max="100000000" step="5000">
                        </div>
                    </div>
                    
                    <div class="section-title">Investment Profile</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Years</label>
                            <input type="number" id="duration" value="30" max="40" min="1">
                        </div>
                        <div class="input-group">
                            <label>Return %</label>
                            <input type="number" id="returnRate" value="24" max="30">
                        </div>
                    </div>
                    
                    <div class="scenario-chips">
                        <div class="chip" data-rate="12">12%</div>
                        <div class="chip active" data-rate="24">24%</div>
                        <div class="chip" data-rate="30">30%</div>
                    </div>
                    
                    <div class="input-group">
                        <label>Goal Target (Cr)</label>
                        <input type="number" id="goalAmount" value="10" step="0.5">
                    </div>

                    <div class="section-title">Top-Up Configuration</div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Top-Up (â‚¹)</label>
                            <input type="number" id="stepUpAmount" value="1000" step="500">
                        </div>
                         <div class="input-group">
                            <label>Freq.</label>
                            <select id="stepUpFrequency">
                                <option value="6">Half-Yr</option>
                                <option value="12" selected>Yearly</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>% Step-Up</label>
                        <input type="number" id="stepUpPercentage" value="15" max="24">
                    </div>
                    <button type="button" id="resetBtn" class="reset-btn">Reset Defaults</button>
                </form>
            </div>

            <!-- Strategy DNA (Visual Comparison) -->
            <div class="sidebar-footer">
                <div class="dna-panel">
                    <div class="dna-title">
                        <span>Strategy DNA</span>
                        <span style="opacity:0.6; font-weight:400">Wealth Potential</span>
                    </div>
                    
                    <div class="dna-row">
                        <div class="dna-label"><span>Regular SIP</span></div>
                        <div class="dna-bar-bg"><div class="dna-bar-fill fill-reg" id="bar-reg"></div></div>
                    </div>
                    <div class="dna-row">
                        <div class="dna-label"><span>Fixed Top-Up</span></div>
                        <div class="dna-bar-bg"><div class="dna-bar-fill fill-fix" id="bar-fix"></div></div>
                    </div>
                    <div class="dna-row">
                        <div class="dna-label"><span>% Step-Up</span></div>
                        <div class="dna-bar-bg"><div class="dna-bar-fill fill-per" id="bar-per"></div></div>
                    </div>
                    <div class="dna-row">
                        <div class="dna-label"><span>Lumpsum</span></div>
                        <div class="dna-bar-bg"><div class="dna-bar-fill fill-lum" id="bar-lum"></div></div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Panel -->
        <main class="main-panel">
            
            <!-- Cards Section -->
            <div class="summary-grid">
                <!-- Regular SIP Card -->
                <div class="card regular">
                    <div class="card-header">
                        <h3>Regular SIP</h3>
                        <span class="badge" id="badge-regular">Regular</span>
                    </div>
                    <div class="card-metrics">
                        <div class="metric-item main-val">
                            <span class="metric-label">Final Value</span>
                            <div class="main-val-container">
                                <span class="metric-value highlight" id="summary-value-regular">â‚¹0</span>
                            </div>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Invested</span>
                            <span class="metric-value" id="summary-invest-regular">â‚¹0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Returns</span>
                            <span class="metric-value" id="summary-returns-regular">â‚¹0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">CAGR</span>
                            <span class="metric-value" id="summary-cagr-regular">0%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Multiplier</span>
                            <span class="metric-value" id="summary-multiplier-regular">0x</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">ROI</span>
                            <span class="metric-value" id="summary-roi-regular">0%</span>
                        </div>
                         <div class="metric-item">
                            <span class="metric-label">Goal Met</span>
                            <span class="metric-value" id="summary-goal-regular">-</span>
                        </div>
                    </div>
                </div>

                <!-- Fixed Top-Up Card -->
                <div class="card fixed">
                    <div class="card-header">
                        <h3>Fixed Top-Up</h3>
                        <span class="badge" id="badge-fixed">Fixed</span>
                    </div>
                    <div class="card-metrics">
                        <div class="metric-item main-val">
                            <span class="metric-label">Final Value</span>
                            <div class="main-val-container">
                                <span class="metric-value highlight" id="summary-value-fixed">â‚¹0</span>
                                <span class="gain-badge" id="summary-gain-fixed"></span>
                            </div>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Invested</span>
                            <span class="metric-value" id="summary-invest-fixed">â‚¹0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Returns</span>
                            <span class="metric-value" id="summary-returns-fixed">â‚¹0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">CAGR</span>
                            <span class="metric-value" id="summary-cagr-fixed">0%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Multiplier</span>
                            <span class="metric-value" id="summary-multiplier-fixed">0x</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">ROI</span>
                            <span class="metric-value" id="summary-roi-fixed">0%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Goal Met</span>
                            <span class="metric-value" id="summary-goal-fixed">-</span>
                        </div>
                    </div>
                </div>

                <!-- Percent Step-Up Card -->
                <div class="card percent">
                    <div class="card-header">
                        <h3>% Step-Up</h3>
                        <span class="badge" id="badge-percent">Step-Up</span>
                    </div>
                    <div class="card-metrics">
                        <div class="metric-item main-val">
                            <span class="metric-label">Final Value</span>
                            <div class="main-val-container">
                                <span class="metric-value highlight" id="summary-value-percent">â‚¹0</span>
                                <span class="gain-badge" id="summary-gain-percent"></span>
                            </div>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Invested</span>
                            <span class="metric-value" id="summary-invest-percent">â‚¹0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Returns</span>
                            <span class="metric-value" id="summary-returns-percent">â‚¹0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">CAGR</span>
                            <span class="metric-value" id="summary-cagr-percent">0%</span>
                        </div>
                         <div class="metric-item">
                            <span class="metric-label">Multiplier</span>
                            <span class="metric-value" id="summary-multiplier-percent">0x</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">ROI</span>
                            <span class="metric-value" id="summary-roi-percent">0%</span>
                        </div>
                         <div class="metric-item">
                            <span class="metric-label">Goal Met</span>
                            <span class="metric-value" id="summary-goal-percent">-</span>
                        </div>
                    </div>
                </div>

                <!-- Lumpsum Card -->
                <div class="card lumpsum">
                    <div class="card-header">
                        <h3>Lumpsum</h3>
                        <span class="badge" id="badge-lumpsum">Lumpsum</span>
                    </div>
                    <div class="card-metrics">
                        <div class="metric-item main-val">
                            <span class="metric-label">Final Value</span>
                             <div class="main-val-container">
                                <span class="metric-value highlight" id="summary-value-lumpsum">â‚¹0</span>
                             </div>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Invested</span>
                            <span class="metric-value" id="summary-invest-lumpsum">â‚¹0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Returns</span>
                            <span class="metric-value" id="summary-returns-lumpsum">â‚¹0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">CAGR</span>
                            <span class="metric-value" id="summary-cagr-lumpsum">0%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Multiplier</span>
                            <span class="metric-value" id="summary-multiplier-lumpsum">0x</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">ROI</span>
                            <span class="metric-value" id="summary-roi-lumpsum">0%</span>
                        </div>
                         <div class="metric-item">
                            <span class="metric-label">Goal Met</span>
                            <span class="metric-value" id="summary-goal-lumpsum">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table Section -->
            <div class="table-wrapper">
                <div class="table-header-title">Yearly Projection (Auto-fits Screen)</div>
                <div class="auto-size-container">
                    <div class="flex-table super-dense">
                        <!-- Table Header -->
                        <div class="flex-thead">
                            <div class="flex-row">
                                <div class="flex-cell w-yr">Yr</div>
                                <div class="group-reg"><div class="flex-cell" style="flex:1; justify-content:center;">Regular SIP</div></div>
                                <div class="group-fix"><div class="flex-cell" style="flex:1; justify-content:center;">Fixed Top-Up</div></div>
                                <div class="group-per"><div class="flex-cell" style="flex:1; justify-content:center;">% Step-Up</div></div>
                                <div class="group-lum"><div class="flex-cell" style="flex:1; justify-content:center;">Lumpsum</div></div>
                            </div>
                            <div class="flex-row" style="border-top:1px solid rgba(0,0,0,0.05)">
                                <div class="flex-cell w-yr"></div>
                                <!-- Regular -->
                                <div class="group-reg">
                                    <div class="flex-cell c-val">Value</div>
                                    <div class="flex-cell c-tinv">T.Inv</div>
                                    <div class="flex-cell c-inv">Yr.Inv</div>
                                    <div class="flex-cell c-pct">%</div>
                                </div>
                                <!-- Fixed -->
                                <div class="group-fix">
                                    <div class="flex-cell c-val">Value</div>
                                    <div class="flex-cell c-tinv">T.Inv</div>
                                    <div class="flex-cell c-inv">Yr.Inv</div>
                                    <div class="flex-cell c-pct">%</div>
                                </div>
                                <!-- Percent -->
                                <div class="group-per">
                                    <div class="flex-cell c-val">Value</div>
                                    <div class="flex-cell c-tinv">T.Inv</div>
                                    <div class="flex-cell c-inv">Yr.Inv</div>
                                    <div class="flex-cell c-pct">%</div>
                                </div>
                                <!-- Lumpsum -->
                                <div class="group-lum">
                                    <div class="flex-cell c-val">Value</div>
                                    <div class="flex-cell c-inv">T.Inv</div>
                                    <div class="flex-cell c-pct">%</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Table Body -->
                        <div class="flex-tbody" id="resultsTableBody">
                            <!-- Rows injected by JS -->
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- Elements ---
        const inputs = {
            initialSip: document.getElementById('initialSip'),
            lumpsumAmount: document.getElementById('lumpsumAmount'),
            duration: document.getElementById('duration'),
            returnRate: document.getElementById('returnRate'),
            goalAmount: document.getElementById('goalAmount'),
            stepUpAmount: document.getElementById('stepUpAmount'),
            stepUpFrequency: document.getElementById('stepUpFrequency'),
            stepUpPercentage: document.getElementById('stepUpPercentage')
        };
        
        const form = document.getElementById('sipForm');
        const themeToggle = document.getElementById('themeToggle');
        const chips = document.querySelectorAll('.chip');
        const resetBtn = document.getElementById('resetBtn');
        const tableBody = document.getElementById('resultsTableBody');

        const DEFAULTS = {
            initialSip: 7000, lumpsumAmount: 500000, duration: 30, returnRate: 24,
            stepUpAmount: 1000, stepUpFrequency: 12, stepUpPercentage: 15, goalAmount: 10
        };

        // --- Logic ---
        function calculate() {
            let p = parseFloat(inputs.initialSip.value) || 0;
            let lumpsum = parseFloat(inputs.lumpsumAmount.value) || 0;
            let n = parseInt(inputs.duration.value) || 0;
            let r = parseFloat(inputs.returnRate.value) || 0;
            let goalCr = parseFloat(inputs.goalAmount.value) || 0;
            let sAmt = parseFloat(inputs.stepUpAmount.value) || 0;
            let sFreq = parseInt(inputs.stepUpFrequency.value) || 12;
            let sPerc = parseFloat(inputs.stepUpPercentage.value) || 0;

            if (p > 100000) { inputs.initialSip.value = 100000; p = 100000; }
            if (lumpsum > 100000000) { inputs.lumpsumAmount.value = 100000000; lumpsum = 100000000; }
            if (n > 40) { inputs.duration.value = 40; n = 40; }
            if (r > 30) { inputs.returnRate.value = 30; r = 30; }
            if (sPerc > 24) { inputs.stepUpPercentage.value = 24; sPerc = 24; }
            
            const goal = goalCr * 10000000;
            const monthlyRate = r / 100 / 12;
            const months = n * 12;

            let regVal = 0, regInv = 0;
            let fixVal = 0, fixInv = 0, fixCurSip = p;
            let perVal = 0, perInv = 0, perCurSip = p;
            let lumVal = lumpsum; // Start with principal

            // Annual Investment Trackers
            let regYearlyInv = 0;
            let fixYearlyInv = 0;
            let perYearlyInv = 0;

            let goalYear = { reg: null, fix: null, per: null, lum: null };
            let rows = [];

            for (let m = 1; m <= months; m++) {
                // Returns (Invest at start of month)
                regVal = (regVal + p) * (1 + monthlyRate);
                regInv += p;
                regYearlyInv += p;

                fixVal = (fixVal + fixCurSip) * (1 + monthlyRate);
                fixInv += fixCurSip;
                fixYearlyInv += fixCurSip;

                perVal = (perVal + perCurSip) * (1 + monthlyRate);
                perInv += perCurSip;
                perYearlyInv += perCurSip;
                
                // Lumpsum Growth
                lumVal = lumVal * (1 + monthlyRate);

                // Step up logic for NEXT month
                if (m < months) {
                    if (m % sFreq === 0) {
                        fixCurSip += sAmt;
                    }
                    if (m % 12 === 0) {
                        perCurSip *= (1 + sPerc / 100);
                    }
                }

                if (m % 12 === 0) {
                    const yr = m / 12;
                    if (!goalYear.reg && regVal >= goal) goalYear.reg = yr;
                    if (!goalYear.fix && fixVal >= goal) goalYear.fix = yr;
                    if (!goalYear.per && perVal >= goal) goalYear.per = yr;
                    if (!goalYear.lum && lumVal >= goal) goalYear.lum = yr;

                    rows.push({
                        yr,
                        reg: { val: regVal, cumInv: regInv, yrInv: regYearlyInv },
                        fix: { val: fixVal, cumInv: fixInv, yrInv: fixYearlyInv },
                        per: { val: perVal, cumInv: perInv, yrInv: perYearlyInv },
                        lum: { val: lumVal, cumInv: lumpsum } // Lumpsum doesn't have yearly inv
                    });

                    // Reset Annual Counters
                    regYearlyInv = 0;
                    fixYearlyInv = 0;
                    perYearlyInv = 0;
                }
            }

            updateUI({ regVal, regInv, fixVal, fixInv, perVal, perInv, lumVal, lumInv: lumpsum }, goalYear, rows, n);
            updateChips(r);
        }

        function updateUI(finals, goals, rows, years) {
            // Rank Strategies for Badges & DNA
            const strategies = [
                { id: 'regular', name: 'Regular', val: finals.regVal, bar: 'bar-reg' },
                { id: 'fixed', name: 'Fixed', val: finals.fixVal, bar: 'bar-fix' },
                { id: 'percent', name: 'Step-Up', val: finals.perVal, bar: 'bar-per' },
                { id: 'lumpsum', name: 'Lumpsum', val: finals.lumVal, bar: 'bar-lum' }
            ];
            
            // Sort for badges
            const sorted = [...strategies].sort((a, b) => b.val - a.val);
            const maxVal = sorted[0].val;

            // Assign Badges
            strategies.forEach((s) => {
                const badgeEl = document.getElementById(`badge-${s.id}`);
                const rank = sorted.findIndex(item => item.id === s.id);
                let badgeClass = 'base';
                let icon = '';
                
                if (rank === 0) { badgeClass = 'gold'; icon = 'ðŸ¥‡'; }
                else if (rank === 1) { badgeClass = 'silver'; icon = 'ðŸ¥ˆ'; }
                else if (rank === 2) { badgeClass = 'bronze'; icon = 'ðŸ¥‰'; }
                
                badgeEl.className = `badge ${badgeClass}`;
                badgeEl.textContent = `${icon} ${s.name}`;
            });

            // Update DNA Bars
            strategies.forEach(s => {
                const width = (s.val / maxVal) * 100;
                document.getElementById(s.bar).style.width = `${width}%`;
            });

            // Update Cards
            updateCard('regular', finals.regVal, finals.regInv, goals.reg, 0, years);
            updateCard('fixed', finals.fixVal, finals.fixInv, goals.fix, finals.fixVal - finals.regVal, years);
            updateCard('percent', finals.perVal, finals.perInv, goals.per, finals.perVal - finals.regVal, years);
            updateCard('lumpsum', finals.lumVal, finals.lumInv, goals.lum, 0, years);

            // Update Table
            let html = '';
            rows.forEach(r => {
                // Calculate Total ROI % based on CUMULATIVE Investment
                const roiReg = r.reg.cumInv > 0 ? ((r.reg.val - r.reg.cumInv)/r.reg.cumInv * 100).toFixed(0) + '%' : '-';
                const roiFix = r.fix.cumInv > 0 ? ((r.fix.val - r.fix.cumInv)/r.fix.cumInv * 100).toFixed(0) + '%' : '-';
                const roiPer = r.per.cumInv > 0 ? ((r.per.val - r.per.cumInv)/r.per.cumInv * 100).toFixed(0) + '%' : '-';
                const roiLum = r.lum.cumInv > 0 ? ((r.lum.val - r.lum.cumInv)/r.lum.cumInv * 100).toFixed(0) + '%' : '-';

                html += `
                <div class="flex-row">
                    <div class="flex-cell w-yr">${r.yr}</div>
                    
                    <div class="group-reg">
                        <div class="flex-cell c-val col-reg">${formatCompact(r.reg.val)}</div>
                        <div class="flex-cell c-tinv">${formatCompact(r.reg.cumInv)}</div>
                        <div class="flex-cell c-inv">${formatCompact(r.reg.yrInv)}</div>
                        <div class="flex-cell c-pct">${roiReg}</div>
                    </div>
                    
                    <div class="group-fix">
                        <div class="flex-cell c-val col-fix">${formatCompact(r.fix.val)}</div>
                        <div class="flex-cell c-tinv">${formatCompact(r.fix.cumInv)}</div>
                        <div class="flex-cell c-inv">${formatCompact(r.fix.yrInv)}</div>
                        <div class="flex-cell c-pct">${roiFix}</div>
                    </div>
                    
                    <div class="group-per">
                        <div class="flex-cell c-val col-per">${formatCompact(r.per.val)}</div>
                        <div class="flex-cell c-tinv">${formatCompact(r.per.cumInv)}</div>
                        <div class="flex-cell c-inv">${formatCompact(r.per.yrInv)}</div>
                        <div class="flex-cell c-pct">${roiPer}</div>
                    </div>

                    <div class="group-lum">
                        <div class="flex-cell c-val col-lum">${formatCompact(r.lum.val)}</div>
                        <div class="flex-cell c-inv">${formatCompact(r.lum.cumInv)}</div>
                        <div class="flex-cell c-pct">${roiLum}</div>
                    </div>
                </div>`;
            });
            tableBody.innerHTML = html;
        }

        function updateCard(type, val, inv, goalYr, gain, years) {
            const el = (id) => document.getElementById(`summary-${id}-${type}`);
            const ret = val - inv;
            
            el('value').textContent = formatCurrency(val);
            el('invest').textContent = formatCompact(inv);
            el('returns').textContent = formatCompact(ret);
            el('cagr').textContent = calcCAGR(inv, val, years).toFixed(2) + '%';
            
            if (el('multiplier')) el('multiplier').textContent = (inv > 0 ? (val / inv).toFixed(1) : 0) + 'x';
            if (el('roi')) el('roi').textContent = (inv > 0 ? ((ret / inv) * 100).toFixed(0) : 0) + '%';
            
            const goalEl = el('goal');
            if (goalYr) {
                goalEl.textContent = `Year ${goalYr}`;
                goalEl.className = 'metric-value met-year';
            } else {
                goalEl.textContent = 'Not Met';
                goalEl.className = 'metric-value missed-year';
            }

            if ((type === 'fixed' || type === 'percent')) {
                 const gainEl = document.getElementById(`summary-gain-${type}`);
                 if (gainEl) gainEl.textContent = '(+' + formatCompact(gain) + ')';
            }
        }

        // --- Utils ---
        const formatCurrency = (num) => new Intl.NumberFormat('en-IN', {
            style: 'currency', currency: 'INR', maximumFractionDigits: 0
        }).format(num);

        const formatCompact = (num) => {
            if (num >= 10000000) return (num / 10000000).toFixed(2) + 'Cr';
            if (num >= 100000) return (num / 100000).toFixed(2) + 'L';
            if (num >= 1000) return (num/1000).toFixed(1) + 'k';
            return num.toFixed(0);
        };
        
        const calcCAGR = (beg, end, yrs) => {
            if (beg <= 0 || end <= 0 || yrs <= 0) return 0;
            return (Math.pow((end / beg), (1 / yrs)) - 1) * 100;
        };

        const updateChips = (rate) => chips.forEach(c => c.classList.toggle('active', parseFloat(c.dataset.rate) === rate));

        // --- Events ---
        form.addEventListener('input', calculate);
        resetBtn.addEventListener('click', () => {
            inputs.initialSip.value = DEFAULTS.initialSip;
            inputs.lumpsumAmount.value = DEFAULTS.lumpsumAmount;
            inputs.duration.value = DEFAULTS.duration;
            inputs.returnRate.value = DEFAULTS.returnRate;
            inputs.stepUpAmount.value = DEFAULTS.stepUpAmount;
            inputs.stepUpFrequency.value = DEFAULTS.stepUpFrequency;
            inputs.stepUpPercentage.value = DEFAULTS.stepUpPercentage;
            inputs.goalAmount.value = DEFAULTS.goalAmount;
            calculate();
        });
        chips.forEach(chip => chip.addEventListener('click', () => {
            inputs.returnRate.value = chip.dataset.rate;
            calculate();
        }));
        themeToggle.addEventListener('change', (e) => {
            const isDark = e.target.checked;
            document.body.classList.toggle('dark-theme', isDark);
            localStorage.setItem('sipTheme', isDark ? 'dark' : 'light');
        });

        // Init
        const savedTheme = localStorage.getItem('sipTheme') === 'dark';
        document.body.classList.toggle('dark-theme', savedTheme);
        themeToggle.checked = savedTheme;
        calculate();

    </script>
</body>
</html>
